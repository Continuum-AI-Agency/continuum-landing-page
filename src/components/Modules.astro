---
import { Image } from 'astro:assets';

import studioImg from '../assets/Fotos_productos/Studio.jpeg';
import socialImg from '../assets/Fotos_productos/Creative studio_User_manual.jpg';
import performanceImg from '../assets/Fotos_productos/Performance.jpeg';
---

<section id="modules" class="ch-section">
  <div class="ch-section-header reveal">
    <h2>Three modules. One continuum</h2>
    <p>
      Plug in only what you need or run Continuum as your full creative OS.
    </p>
  </div>

  <div class="ch-modules-layout reveal">
    <!-- COLUMN: TABS -->
    <div class="ch-modules-tabs">
      <!-- STUDIO+ -->
      <button
        class="ch-module-tab is-active"
        type="button"
        data-module="studio"
        data-cta="Perfect for in-house studios and brand teams that need to scale production without losing control."
        data-cta-btn="Talk to us about STUDIO+"
      >
        <div class="ch-module-tab-header">
          <div class="ch-module-tab-title">
            <div>
              <span class="ch-module-label ch-module-label--studio">STUDIO+</span>
              <span class="ch-module-name">Template-driven production</span>
            </div>
            <span class="ch-module-headline">
              Create once. Ship everywhere.
            </span>
          </div>
          <span class="ch-module-chevron">⟶</span>
        </div>

        <p class="ch-module-kicker"></p>
        <ul class="ch-module-list">
          <li>Automated assets, built to scale.</li>
        </ul>
      </button>

      <!-- SOCIAL+ -->
      <button
        class="ch-module-tab"
        type="button"
        data-module="social"
        data-cta="Perfect for social & community teams that need a steady stream of on-brand content."
        data-cta-btn="Talk to us about SOCIAL+"
      >
        <div class="ch-module-tab-header">
          <div class="ch-module-tab-title">
            <div>
              <span class="ch-module-label ch-module-label--social">SOCIAL+</span>
              <span class="ch-module-name">Always-on social</span>
            </div>
            <span class="ch-module-headline">
              Never let your feeds go quiet.
            </span>
          </div>
          <span class="ch-module-chevron">⟶</span>
        </div>

        <p class="ch-module-kicker"></p>
        <ul class="ch-module-list">
          <li>Data-driven social, always alive.</li>
        </ul>
      </button>

      <!-- PERFORMANCE+ -->
      <button
        class="ch-module-tab"
        type="button"
        data-module="performance"
        data-cta="Perfect for performance marketers who need creative and budgets to sync automatically."
        data-cta-btn="Talk to us about PERFORMANCE+"
      >
        <div class="ch-module-tab-header">
          <div class="ch-module-tab-title">
            <div>
              <span class="ch-module-label ch-module-label--performance">PERFORMANCE+</span>
              <span class="ch-module-name">Creative x media engine</span>
            </div>
            <span class="ch-module-headline">
              Optimize spend and ideas together.
            </span>
          </div>
          <span class="ch-module-chevron">⟶</span>
        </div>

        <p class="ch-module-kicker"></p>
        <ul class="ch-module-list">
          <li>Data-driven social, always alive.</li>
        </ul>
      </button>

      <!-- CTA ABAJO A LA IZQUIERDA -->
      <div class="ch-modules-cta">
        <p id="modules-cta-text">
          Perfect for in-house studios and brand teams that need to scale production without losing control.
        </p>
        <button
          class="ch-btn ch-btn-primary ch-modules-cta-btn"
          id="modules-cta-btn"
        >
          Talk to us about STUDIO+
        </button>
      </div>
    </div>
    
    <div class="ch-modules-visual">
       <br><br><br>
       <div class="ch-module-shot is-active" data-module-shot="studio">
         <div class="ch-modules-gallery">
           <Image src={studioImg} alt="Studio+ view 1" />
         </div>
       </div>

       <div class="ch-module-shot" data-module-shot="social">
         <div class="ch-modules-gallery">
           <Image src={socialImg} alt="Social+ view 1" />
         </div>
       </div>

       <div class="ch-module-shot" data-module-shot="performance">
         <div class="ch-modules-gallery">
           <Image src={performanceImg} alt="Performance+ view 1" />
         </div>
       </div>
    </div>

  </div>
</section>

<script>
  // Modules tabs
  const moduleTabs = document.querySelectorAll(".ch-module-tab");
  const moduleShots = document.querySelectorAll("[data-module-shot]");
  const modulesCtaText = document.getElementById("modules-cta-text");
  const modulesCtaBtn = document.getElementById("modules-cta-btn");

  if (moduleTabs.length && moduleShots.length) {
    moduleTabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        if (!(tab instanceof HTMLElement)) return;
        const target = tab.dataset.module;

        // marcar tab activa
        moduleTabs.forEach((t) => {
          t.classList.toggle("is-active", t === tab);
        });

        // cambiar screenshot
        moduleShots.forEach((shot) => {
           if (shot instanceof HTMLElement) {
               const isTarget = shot.dataset.moduleShot === target;
               shot.classList.toggle("is-active", isTarget);
           }
        });

        // actualizar copy del CTA
        if (modulesCtaText && tab.dataset.cta) {
          modulesCtaText.textContent = tab.dataset.cta;
        }
        if (modulesCtaBtn && tab.dataset.ctaBtn) {
          modulesCtaBtn.textContent = tab.dataset.ctaBtn;
        }
      });
    });
  }

  // Zoom Effect
  document.querySelectorAll(".ch-modules-visual").forEach((container) => {
      const getActiveImg = () => container.querySelector(".ch-module-shot.is-active .ch-modules-gallery img") as HTMLElement;

      container.addEventListener("mouseenter", () => {
        container.classList.add("is-zooming");
      });

      container.addEventListener("mouseleave", () => {
        container.classList.remove("is-zooming");
        const img = getActiveImg();
        if (img) img.style.transformOrigin = "50% 50%";
      });

      container.addEventListener("mousemove", (e) => {
        if(!(e instanceof MouseEvent)) return;
        const img = getActiveImg();
        if (!img) return;

        const rect = container.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;

        img.style.transformOrigin = `${x}% ${y}%`;
      });
  });
  
  // Reveal
  if ("IntersectionObserver" in window) {
      const observer = new IntersectionObserver((entries) => {
          entries.forEach(e => {
              if (e.isIntersecting) {
                  e.target.classList.add("is-visible");
                  observer.unobserve(e.target);
              }
          })
      }, { threshold: 0.1 });
      const el = document.querySelector("#modules");
      if(el) el.querySelectorAll(".reveal").forEach(r => observer.observe(r));
  }
</script>